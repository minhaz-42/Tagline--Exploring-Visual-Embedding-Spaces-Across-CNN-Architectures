{% extends "base.html" %}
{% load static %}

{% block title %}Search History — Tagline{% endblock %}
{% block nav_history %}active{% endblock %}

{% block content %}
<header class="page-header">
    <h1 class="page-title">Search History</h1>
    <p class="page-subtitle">All past image retrieval queries — click any entry to revisit full results</p>
</header>

{% if searches %}
<div class="table-wrapper history-table-wrap">
    <table class="metrics-table">
        <thead>
            <tr>
                <th class="th-image">Image</th>
                <th>Model</th>
                <th>Top Result</th>
                <th>Similarity</th>
                <th>Results</th>
                <th>Time</th>
                <th class="th-action">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in searches %}
            <tr>
                <td>
                    {% if item.query_image_url %}
                    <img src="{% static item.query_image_url %}" alt="Query"
                         class="history-thumb-sm">
                    {% else %}
                    <div class="history-thumb-fallback">
                        &#x1F5BC;
                    </div>
                    {% endif %}
                </td>
                <td>
                    <span class="meta-badge model-badge badge-sm">{{ item.model_display }}</span>
                </td>
                <td>
                    <strong>{{ item.top_result_class|default:"—" }}</strong>
                </td>
                <td>
                    {% if item.top_similarity %}
                    <span class="text-mono-strong">{{ item.top_similarity }}</span>
                    {% else %}
                    <span class="text-muted">—</span>
                    {% endif %}
                </td>
                <td>{{ item.result_count }}</td>
                <td class="time-cell">
                    {{ item.created_at|timesince }} ago
                </td>
                <td>
                    {% if item.has_results %}
                    <a href="{% url 'result_detail' item.id %}" class="btn btn-outline btn-xs">
                        View
                    </a>
                    {% else %}
                    <span class="text-muted-sm">N/A</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="actions">
    <a href="{% url 'search_page' %}" class="btn btn-primary">&#x1F50D; New Search</a>
</div>

{% else %}
<div class="empty-state">
    <div class="empty-state-icon">&#x1F50D;</div>
    <h3>No searches yet</h3>
    <p>Start by uploading an image to find visually similar results across CNN embedding spaces.</p>
    <a href="{% url 'search_page' %}" class="btn btn-primary btn-lg">Start Searching</a>
</div>
{% endif %}
{% endblock %}
